<Window x:Class="SpinMonitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:SpinMonitor.Converters"
        Title="SpinMonitor - Audio Stream Monitor"
        Height="720" Width="1200"
        WindowStartupLocation="CenterScreen">

  <Window.Resources>
    <conv:ContainsConverter x:Key="Contains"/>

    <Style x:Key="StreamRowStyle" TargetType="DataGridRow">
      <Style.Triggers>
        <DataTrigger Value="True">
          <DataTrigger.Binding>
            <Binding Path="Status"
                     Converter="{StaticResource Contains}"
                     ConverterParameter="Offline"/>
          </DataTrigger.Binding>
          <Setter Property="Background" Value="#FAD6D6"/>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <Style TargetType="Button">
      <Setter Property="Margin" Value="0,0,8,0"/>
      <Setter Property="Padding" Value="10,4"/>
    </Style>
  </Window.Resources>

  <DockPanel LastChildFill="True">

    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem Header="Settings..." Click="OpenSettings_Click"/>
        <Separator/>
        <MenuItem Header="Manage Fingerprints..." Click="OpenFingerprintManager_Click"/>
        <MenuItem Header="DB Table Viewer..." Click="OpenDbViewer_Click"/>
        <Separator/>
        <MenuItem Header="E_xit" Click="Exit_Click"/>
      </MenuItem>
      <MenuItem Header="_Help">
        <MenuItem Header="README" Click="OpenReadme_Click"/>
      </MenuItem>
    </Menu>

    <Border DockPanel.Dock="Top" Padding="8" BorderBrush="#DDD" BorderThickness="0,0,0,1" Background="#F7F7F7">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Orientation="Horizontal" Grid.Column="0">
          <Button x:Name="StartBtn" Content="Start Monitoring" Click="StartBtn_Click"/>
          <Button x:Name="StopBtn"  Content="Stop Monitoring"  Click="StopBtn_Click" Margin="8,0,0,0"/>
          <!-- âœ… NEW: Reset Button -->
          <Button x:Name="ResetBtn" Content="Reset" Click="ResetBtn_Click" Margin="8,0,0,0" 
                  ToolTip="Force reload of streams and MP3 library"/>
        </StackPanel>

        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock x:Name="CpuLabel" Text="CPU: 0%" Margin="0,0,16,0" VerticalAlignment="Center"/>
          <TextBlock x:Name="NetLabel" Text="NET: 0.000 MB/s" VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>

    <StatusBar DockPanel.Dock="Bottom">
      <StatusBarItem>
        <TextBlock x:Name="StatusText" Text="Ready"/>
      </StatusBarItem>
    </StatusBar>

    <Grid Margin="6" x:Name="CenterGrid">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="3*"/>
        <ColumnDefinition Width="6"/>
        <ColumnDefinition Width="5*"/>
      </Grid.ColumnDefinitions>
      <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="6"/>
        <RowDefinition Height="2*"/>
      </Grid.RowDefinitions>

      <!-- LEFT: Radio Streams -->
      <GroupBox Grid.RowSpan="3" Grid.Column="0" Header="Radio Streams" Margin="0,0,6,0">
        <Grid>
          <DataGrid ItemsSource="{Binding Streams}"
                    RowStyle="{StaticResource StreamRowStyle}"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    IsReadOnly="True"
                    HeadersVisibility="Column"
                    EnableRowVirtualization="True"
                    VirtualizingPanel.IsVirtualizing="True"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    Margin="6">
            <DataGrid.Columns>
              <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="2*"/>
              <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="*" />
              <DataGridTextColumn Header="Detect" Binding="{Binding Detections}" Width="60" />
              <DataGridTextColumn Header="MB/s (PCM)" Width="90">
                <DataGridTextColumn.Binding>
                  <Binding Path="BandwidthMBps" StringFormat="{}{0:0.000}"/>
                </DataGridTextColumn.Binding>
              </DataGridTextColumn>
            </DataGrid.Columns>
          </DataGrid>
        </Grid>
      </GroupBox>

      <GridSplitter Grid.Column="1" Grid.RowSpan="3"
                    Width="6" Background="Transparent"
                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                    ShowsPreview="True"/>

      <!-- RIGHT/TOP: Live Now -->
      <GroupBox Grid.Column="2" Grid.Row="0" Header="Live Now" Margin="0,0,0,6">
        <Grid>
          <DataGrid ItemsSource="{Binding Feedback}"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    IsReadOnly="True"
                    HeadersVisibility="Column"
                    EnableRowVirtualization="True"
                    VirtualizingPanel.IsVirtualizing="True"
                    VirtualizingPanel.ScrollUnit="Pixel"
                    Margin="6">
            <DataGrid.Columns>
              <DataGridTextColumn Header="MP3 name"    Binding="{Binding FileName}"   Width="2*"/>
              <DataGridTextColumn Header="Stream name" Binding="{Binding StreamName}" Width="*"/>
              <DataGridTextColumn Header="Last Seen"   Binding="{Binding LastSeen, StringFormat='{}{0:HH:mm:ss}'}" Width="90"/>
            </DataGrid.Columns>
          </DataGrid>
        </Grid>
      </GroupBox>

      <GridSplitter Grid.Column="2" Grid.Row="1"
                    Height="6" Background="Transparent"
                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                    ShowsPreview="True"/>

      <!-- RIGHT/BOTTOM: Real-time log -->
      <GroupBox Grid.Column="2" Grid.Row="2" Header="Real-time log">
        <Grid>
          <TextBox x:Name="LogBox"
                   FontFamily="Consolas"
                   Foreground="Lime"
                   Background="Black"
                   IsReadOnly="True"
                   TextWrapping="NoWrap"
                   VerticalScrollBarVisibility="Auto"
                   HorizontalScrollBarVisibility="Auto"
                   Margin="6"/>
        </Grid>
      </GroupBox>
    </Grid>
  </DockPanel>
</Window>